<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Qemu STM32 : QEMU with an STM32 microcontroller implementation">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Qemu STM32</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/beckus/qemu_stm32">View on GitHub</a>

          <h1 id="project_title">Qemu STM32</h1>
          <h2 id="project_tagline">QEMU with an STM32 microcontroller implementation</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/beckus/qemu_stm32/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/beckus/qemu_stm32/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="features" class="anchor" href="#features" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Features</h1>

<p>The latest release of QEMU STM32 includes the following features.  Note that only basic functionality may be provided - there will inevitably be features (especially uncommon features) that are not emulated.  I have included links to the relevant commits or files.</p>

<ul>
<li>Built on top of QEMU version 2.1.3</li>
<li>Basic <a href="https://github.com/beckus/qemu_stm32/blob/stm32/hw/arm/stm32.c">STM32F1 microcontroller</a> with the following peripherals:

<ul>
<li><a href="https://github.com/beckus/qemu_stm32/blob/stm32/hw/arm/stm32_adc.c">ADC</a></li>
<li><a href="https://github.com/beckus/qemu_stm32/blob/stm32/hw/gpio/stm32_afio.c">AFIO</a></li>
<li><a href="https://github.com/beckus/qemu_stm32/blob/stm32/hw/arm/stm32_dac.c">DAC</a></li>
<li><a href="https://github.com/beckus/qemu_stm32/blob/stm32/hw/gpio/stm32_exti.c">EXTI</a></li>
<li><a href="https://github.com/beckus/qemu_stm32/blob/stm32/hw/gpio/stm32_gpio.c">GPIO</a></li>
<li><a href="https://github.com/beckus/qemu_stm32/blob/stm32/hw/arm/stm32_iwdg.c">IWDG</a></li>
<li><a href="https://github.com/beckus/qemu_stm32/blob/stm32/hw/arm/stm32_rcc.c">RCC</a></li>
<li><a href="https://github.com/beckus/qemu_stm32/blob/stm32/hw/timer/stm32_rtc.c">RTC</a></li>
<li>
<a href="https://github.com/beckus/qemu_stm32/blob/stm32/hw/timer/stm32_timer.c">TIMER</a> - 
Note that some modes such as counting down and one shot mode do not appear to work quite right and need some work.</li>
<li><a href="https://github.com/beckus/qemu_stm32/blob/stm32/hw/char/stm32_uart.c">UART</a></li>
</ul>
</li>
<li>Machines:

<ul>
<li><a href="https://github.com/beckus/qemu_stm32/blob/stm32/hw/arm/stm32_p103.c">Olimex STM32-P103 development board</a></li>
<li><a href="https://github.com/beckus/qemu_stm32/blob/stm32/hw/arm/stm32_maple.c">Olimex Olimexino STM32 Maple Development Board</a></li>
</ul>
</li>
<li>Changes to core QEMU functionality (in ARMv7 code):

<ul>
<li><a href="https://github.com/beckus/qemu_stm32/commit/3ff4c22bb0d5f73e7bdbb825a38027d12420fe4e">Added external Systick source</a></li>
<li><a href="https://github.com/beckus/qemu_stm32/commit/88a7608eba13ac882259341ca043c492f7be181c">Fixed interrupt handling (specifically for compatibility with FreeRTOS)</a></li>
</ul>
</li>
<li>The <a href="https://github.com/beckus/stm32_p103_demos">stm32_p103_demos project</a> contains demos that run in this emulator.</li>
</ul>

<p>The <a href="https://www.pebble.com/">Pebble Smartwatch</a> also has a QEMU emulator with STM32 functionality (it was originally based on the QEMU STM32 project).  It is located at: <a href="https://github.com/pebble/qemu">https://github.com/pebble/qemu</a> .  While I have not tried the Pebble emulator, it seems quite extensive, with more peripherals (e.g. I2C and SPI) and the ability to emulate different STM32 families.</p>

<h1>
<a id="whats-new" class="anchor" href="#whats-new" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What's New</h1>

<p><strong>July 24, 2018</strong></p>

The following changes have been added in the stm32 branch, though not yet included in a release.
<ul>
<li>Added Dockerfile to build a container with qemu_stm32 binaries and examples from <a href="https://github.com/beckus/stm32_p103_demos">stm32_p103_demos</a>.  Thank you to <a href="https://github.com/glatard">glatard</a> for submitting this.</li>
<li>Fixes to the RTC interrupt handling.  Thank you to <a href="https://github.com/slaviber">slaviber</a>.</li>
<li>Fix build error in recent versions of perl.  Thank you to <a href="https://github.com/benquike">benquike</a>.</li>
</ul>

<p><strong>July 15, 2016</strong></p>

<ul>
<li>Added IWDG peripheral implementation.  Thank you to <a href="https://github.com/vinifr">vinifr</a> for submitting this.  The peripheral is in the stm32 branch but not yet included in a release.</li>
</ul>

<p><strong>April 2, 2016</strong></p>

<ul>
<li>Added ADC, DAC, and RTC peripheral implementations.  Thank you to Hariri Yasser, Fatima Zohra Lahlou, and Jean-Michel Friedt for submitting these.  The peripherals are in the stm32 branch but not yet included in a release.</li>
<li>Corresponding tests were also added to the <a href="https://github.com/beckus/stm32_p103_demos">stm32_p103_demos project</a>.  The ADC demo now works (previously it only worked on real hardware).</li>
</ul>

<p><strong>June 6, 2015 - <a href="https://github.com/beckus/qemu_stm32/releases/tag/stm32_v0.1.3">Release v0.1.3</a></strong></p>

<ul>
<li>Added timer peripheral (thank you to <a href="https://github.com/hankhank">hankhank</a> for writing this)</li>
<li>Merged in QEMU v2.1.3</li>
<li>Fixed bugs in GPIO module (see <a href="https://github.com/beckus/qemu_stm32/commit/3e846fc6272ea226cd3fa5bd255a71e30be0e9b5">commit</a> for more details)</li>
<li>Miscellaneous code cleanup</li>
</ul>

<h1>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h1>

<p>The STM32 implementation is kept in the <a href="https://github.com/beckus/qemu_stm32/tree/stm32">"stm32"</a> branch (the "master" branch contains the unmodified QEMU code).
The "stm32" branch may contain commits that make the software unstable or perhaps even uncompilable.
Therefore, I recommend that you use the latest <a href="https://github.com/beckus/qemu_stm32/releases">tagged release</a> that looks like this: "stm32_v0.x.x".
These are considered to be relatively stable, and at least minimally tested.</p>

<p>See the <a href="https://github.com/beckus/qemu_stm32/blob/stm32/README">README file</a> for more details on compilation, etc..</p>

<h1>
<a id="goals" class="anchor" href="#goals" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Goals</h1>

<p>High level goals (in no particular order):</p>

<ul>
<li>Make compliant with the new QOM framework.  Make use of properties as much as possible to provide visibility into the virtual machine.  For example, the UARTs can have properties indicating their baud rate and configuration.  Also, provide properties to be used for simulating exceptional situations.  For example, the UART could provide properties used to simulate parity and framing errors.  These properties provide debugging advantages over bare hardware and may even allow for automated testing.</li>
<li>Provide complete unit testing of the STM32 implementation â€“ if the unit tests pass you should be confident nothing is broken.</li>
<li>When appropriate, modify core QEMU or add new generic components (e.g. The clock tree objects and unit testing framework).  Submit these components to the main QEMU project if possible.</li>
<li>Continue to add new STM32 peripherals (SPI, timers, etc.) and enhance existing peripherals.</li>
<li>Add new development boards, for example the low cost STM32 discovery boards.  Someone has also suggested supporting the CrazyFlie Nano Quadcopter.  Also add support for the Cortex M4 architecture.</li>
</ul>

<p>I have started a <a href="https://github.com/beckus/qemu_stm32/wiki/To-Do">wiki page with a to-do list</a>, much of which will never become reality.</p>

<h1>
<a id="status" class="anchor" href="#status" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Status</h1>

<p>With a few exceptions, I am not actively developing new functionality.  But I do perform maintenance as I have time, including:</p>

<ul>
<li>Merging in patches from contributors.</li>
<li>Merging in new releases of QEMU.</li>
<li>Fixing defects.</li>
<li>Making occasional limited changes.</li>
<li>Responding to questions.</li>
</ul>

<p>I have not yet submitted any patches to QEMU mainstream for a couple of reasons:</p>

<ol>
<li>This project is still in a state of flux, and I would like the flexibility to change it without going through a patch process.</li>
<li>I suspect it will take some time and effort to go through the submission process - time I would rather put into the project itself.  I have also made changes to the core framework, which may not be acceptable in the main QEMU branch or which will need to be modified.  I don't see much disadvantage to leaving this as a fork.  That being said, there are core components that could benefit other parts of QEMU (i.e. The clock tree objects and unit testing framework) that should be submitted.</li>
</ol>

<h1>
<a id="contributions" class="anchor" href="#contributions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Contributions</h1>

<p>I welcome and encourage any source code contributions.</p>

<p>Thank you to the following users/people for submitting patches:</p>

<ul>
<li><a href="https://github.com/benquike">benquike</a></li>
<li><a href="https://github.com/glatard">glatard</a></li>
<li><a href="https://github.com/hankhank">hankhank</a></li>
<li><a href="https://github.com/krasin">krasin</a></li>
<li><a href="https://github.com/mv0">mv0</a></li>
<li><a href="https://github.com/slaviber">slaviber</a></li>
<li><a href="https://github.com/vinifr">vinifr</a></li>
<li>Hariri Yasser and Fatima Zohra Lahlou (at the UniversitÃ© de Franche-ComtÃ©), under the supervision of Jean-Michel Friedt </li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Qemu STM32 maintained by <a href="https://github.com/beckus">beckus</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-50803151-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
